source('~/Data/GitHub/nvbbcc/rstudio/GCS_COG_example.R')
#--------------------------------------------------------------------------------------------------#
#### Load R libraries
list.of.packages <- c("rgdal", "terra", "sp", "here","RColorBrewer")
invisible(lapply(list.of.packages, library, character.only = TRUE))
`%notin%` <- Negate(`%in%`)
here::here()
#--------------------------------------------------------------------------------------------------#
#--------------------------------------------------------------------------------------------------#
### output location
output_dir <- file.path(here::here("R_Output/GCS_example"))
if (! file.exists(output_dir)) dir.create(output_dir,recursive=TRUE)
outdir <- file.path(path.expand(output_dir))
setwd(outdir) # set working directory
getwd()  # check wd
#--------------------------------------------------------------------------------------------------#
#--------------------------------------------------------------------------------------------------#
# setup datasets. Link to COG as a virtual raster
# RGB
# by appending /vsicurl/ we create a virtual raster
rgb_raster_name <- "NGEEArctic_UAS_Kougarok_20180725_Flight6_RGB_cog.tif"
rgb_cog.url <- "/vsicurl/https://storage.googleapis.com/bnl_uas_data/"
# CHM
# by appending /vsicurl/ we create a virtual raster
chm_raster_name <- "NGEEArctic_UAS_Kougarok_20180725_Flight6_CHM_cog.tif"
chm_cog.url <- "/vsicurl/https://storage.googleapis.com/bnl_uas_data/"
# TIR
tir_raster_name <- "NGEEArctic_UAS_Kougarok_20180725_Flight6_TIR_cog.tif"
tir_cog.url <- "/vsicurl/https://storage.googleapis.com/bnl_uas_data/"
# grab some example locations
example_kg_points <- rgdal::readOGR(file.path(here::here(),
"shapefiles","ngee"),"kg_example_points")
plot(example_kg_points)
#--------------------------------------------------------------------------------------------------#
#--------------------------------------------------------------------------------------------------#
# view raster info / plot raster
# RGB
rgb_ras <- terra::rast(paste0(rgb_cog.url,rgb_raster_name))
RGB(rgb_ras) <- c(1,2,3)
rgb_ras
pdf(file.path(outdir,gsub(".tif",".pdf",rgb_raster_name)), height=9, width=11)
terra::plotRGB(rgb_ras, r=1, g=2, b=3, stretch="lin")
box(lwd=2.2)
dev.off()
# CHM
chm_ras <- terra::rast(paste0(chm_cog.url,chm_raster_name))
names(chm_ras) <- "CHM_meters"
chm_ras
pdf(file.path(outdir,gsub(".tif",".pdf",chm_raster_name)), height=9, width=11)
terra::plot(chm_ras, legend=TRUE, axes=TRUE, smooth=FALSE,range=c(0,315),
col=topo.colors(35), plg=list(x="topright",cex=1,title="CHM (m) x 100"),
pax=list(sides=c(1,2), cex.axis=1.2),
mar=c(2,2,3,5.5)) # b, l, t, r
box(lwd=2.2)
dev.off()
# TIR
tir_ras <- terra::rast(paste0(tir_cog.url,tir_raster_name))
names(tir_ras) <- "Tsurf_degCx10"
tir_ras
pdf(file.path(outdir,gsub(".tif",".pdf",tir_raster_name)), height=9, width=11)
terra::plot(tir_ras, legend=TRUE, axes=TRUE, smooth=TRUE,range=c(170,300),
col=rev(brewer.pal(11,"RdYlBu")),
plg=list(x="topright",cex=1,title="Tsurf (deg C) x 10"),
pax=list(sides=c(1,2), cex.axis=1.2),
mar=c(2,2,3,5.5)) # b, l, t, r
box(lwd=2.2)
dev.off()
#--------------------------------------------------------------------------------------------------#
#--------------------------------------------------------------------------------------------------#
# extract data
pdf(file.path(outdir,paste0(gsub(".tif","",rgb_raster_name),"_points.pdf")), height=9, width=11)
terra::plotRGB(rgb_ras, r=1, g=2, b=3, stretch="lin")
box(lwd=2.2)
points(example_kg_points, pch=20, col="blue", cex=2)
dev.off()
pdf(file.path(outdir,paste0(gsub(".tif","",chm_raster_name),"_points.pdf")), height=9, width=11)
terra::plot(chm_ras, legend=TRUE, axes=TRUE, smooth=FALSE,range=c(0,315),
col=topo.colors(35), plg=list(x="topright",cex=1,title="CHM (m) x 100"),
pax=list(sides=c(1,2), cex.axis=1.2),
mar=c(2,2,3,5.5)) # b, l, t, r
box(lwd=2.2)
terra::points(example_kg_points, pch=20, col="black", cex=2)
dev.off()
# extract data
chm.data <- terra::extract(chm_ras, terra::vect(example_kg_points))
chm.data[,2] <- chm.data[,2]*0.01
tir.data <- terra::extract(tir_ras, terra::vect(example_kg_points))
tir.data[,2] <- tir.data[,2]*0.1
#--------------------------------------------------------------------------------------------------#
# extract data
chm.data <- terra::extract(chm_ras, terra::vect(example_kg_points))
?terra::extract
terra::vect(example_kg_points)
example_kg_points
?terra::vect
